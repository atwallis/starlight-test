---
title: Filter
description: Filter parameter in Restura
---

import { Aside } from '@astrojs/starlight/components';

The filter parameter enables dynamic server-side filtering of paginated results.

## Quick Reference

| Syntax Style      | Format                            | Example                                    |
| ----------------- | --------------------------------- | ------------------------------------------ |
| **New (compact)** | `(column,operator,value)`         | `(status,ne,DELETED)`                      |
| **Old (verbose)** | `(column:name,value:val,type:op)` | `(column:status,value:DELETED,type:exact)` |

Both syntaxes are supported. New syntax is recommended for readability and brevity.

## New Syntax (Recommended)

### Basic Format

```
(column,value)           # Implicit equality
(column,operator,value)  # Explicit operator
```

### Operators

| Operator  | SQL Equivalent  | Description                           | Example               |
| --------- | --------------- | ------------------------------------- | --------------------- |
| _(none)_  | `=`             | Equality (default)                    | `(status,ACTIVE)`     |
| `ne`      | `<>`            | Not equal                             | `(status,ne,DELETED)` |
| `gt`      | `>`             | Greater than                          | `(price,gt,100)`      |
| `gte`     | `>=`            | Greater than or equal                 | `(age,gte,18)`        |
| `lt`      | `<`             | Less than                             | `(stock,lt,10)`       |
| `lte`     | `<=`            | Less than or equal                    | `(score,lte,100)`     |
| `has`     | `ILIKE '%val%'` | Contains substring (case-insensitive) | `(name,has,test)`     |
| `sw`      | `ILIKE 'val%'`  | Starts with (case-insensitive)        | `(email,sw,admin)`    |
| `ew`      | `ILIKE '%val'`  | Ends with (case-insensitive)          | `(file,ew,.pdf)`      |
| `in`      | `IN (...)`      | Matches any value in set              | `(id,in,1\|2\|3)`     |
| `null`    | `IS NULL`       | Is null                               | `(deletedAt,null)`    |
| `notnull` | `IS NOT NULL`   | Is not null                           | `(createdAt,notnull)` |

Operators are **case-insensitive**: `GT`, `Gt`, `gt` all work identically.

### Column Paths

| Format                   | Description            | Example                      | SQL Output                             |
| ------------------------ | ---------------------- | ---------------------------- | -------------------------------------- |
| `column`                 | Single column          | `(status,ACTIVE)`            | `"status" = 'ACTIVE'`                  |
| `table.column`           | Table-qualified column | `(user.email,sw,admin)`      | `"user"."email"::text ILIKE 'admin%'`  |
| `table.column.jsonField` | JSON field access      | `(user.metadata.role,admin)` | `"user"."metadata"->>'role' = 'admin'` |

<Aside type="note">
Column paths cannot exceed 3 parts. `a.b.c.d` is rejected.
</Aside>

### Escaping Special Characters

| Character       | Escape Sequence | Example                 | Result                                      |
| --------------- | --------------- | ----------------------- | ------------------------------------------- |
| `,` (comma)     | `\,`            | `(name,Doe\, John)`     | `"name" = 'Doe, John'`                      |
| `\|` (pipe)     | `\|`            | `(desc,has,A\|B)`       | `"desc"::text ILIKE '%A\|B%'`               |
| `\` (backslash) | `\\`            | `(path,sw,C:\\Windows)` | `"path"::text ILIKE E'C:\\\\Windows%'`      |

Spaces do **not** require escaping:

**Filter:**

```
(name,has,John Doe)
```

**SQL:**

```sql
"name"::text ILIKE '%John Doe%'
```


### IN Operator Values

Use pipes (`|`) to separate multiple values:

**Example 1 - Filter:**

```
(id,in,1|2|3)
```

**SQL:**

```sql
"id" IN (1, 2, 3)
```

---

**Example 2 - Filter:**

```
(status,in,ACTIVE|PENDING|PROCESSING)
```

**SQL:**

```sql
"status" IN ('ACTIVE', 'PENDING', 'PROCESSING')
```

---

**Example 3 - Filter:**

```
(status,in,In Progress|On Hold)
```

**SQL:**

```sql
"status" IN ('In Progress', 'On Hold')
```

Escape literal pipes within values:

**Example 4 - Filter:**

```
(tags,in,red\|green|blue|yellow)
```

**SQL:**

```sql
"tags" IN ('red|green', 'blue', 'yellow')
```


### Logical Operators

| Operator | Description | Example         |
| -------- | ----------- | --------------- |
| `and`    | Logical AND | `(a,1)and(b,2)` |
| `or`     | Logical OR  | `(a,1)or(b,2)`  |

Operators are **case-insensitive**: `AND`, `And`, `and` all work identically.

#### Chaining Multiple Conditions

**Example 1 - Filter:**

```
(a,1)and(b,2)and(c,3)
```

**SQL:**

```sql
"a" = 1 AND "b" = 2 AND "c" = 3
```

---

**Example 2 - Filter:**

```
(a,1)or(b,2)or(c,3)
```

**SQL:**

```sql
"a" = 1 OR "b" = 2 OR "c" = 3
```

---

**Example 3 - Filter:**

```
(a,1)and(b,2)or(c,3)
```

**SQL:**

```sql
"a" = 1 AND "b" = 2 OR "c" = 3
```


### Negation

Prefix expressions with `!` to negate:

**Example 1 - Filter:**

```
!(status,DELETED)
```

**SQL:**

```sql
NOT ("status" = 'DELETED')
```

---

**Example 2 - Filter:**

```
!(a,1)and(b,2)
```

**SQL:**

```sql
NOT ("a" = 1) AND ("b" = 2)
```

---

**Example 3 - Filter:**

```
(a,1)and!(b,2)
```

**SQL:**

```sql
("a" = 1) AND NOT ("b" = 2)
```

---

**Example 4 - Filter:**

```
!(a,1)and!(b,2)
```

**SQL:**

```sql
NOT ("a" = 1) AND NOT ("b" = 2)
```


### Grouping

Use parentheses to control precedence:

**Example 1 - Filter:**

```
((a,1)or(b,2))
```

**SQL:**

```sql
(("a" = 1) OR ("b" = 2))
```

---

**Example 2 - Filter:**

```
((a,1)or(b,2))and((c,3)or(d,4))
```

**SQL:**

```sql
(("a" = 1) OR ("b" = 2)) AND (("c" = 3) OR ("d" = 4))
```

Negate entire groups:

**Example 3 - Filter:**

```
!((a,1)or(b,2))
```

**SQL:**

```sql
NOT (("a" = 1) OR ("b" = 2))
```

---

**Example 4 - Filter:**

```
((a,1)or(b,2))and!((c,3)or(d,4))
```

**SQL:**

```sql
(("a" = 1) OR ("b" = 2)) AND NOT (("c" = 3) OR ("d" = 4))
```


<Aside type="note">
Maximum nesting depth is 1. Expressions like `(((a,1)or(b,2))and(c,3))` are rejected.
</Aside>

### Whitespace

Whitespace is allowed around logical operators and after commas:

**Example 1 - Filter:**

```
(a,1) and (b,2)
```

**SQL:**

```sql
"a" = 1 AND "b" = 2
```

---

**Example 2 - Filter:**

```
(status, ACTIVE)
```

**SQL:**

```sql
"status" = 'ACTIVE'
```

---

**Example 3 - Filter:**

```
(price, gt, 100)
```

**SQL:**

```sql
"price" > 100
```

Whitespace within values is preserved:

**Example 4 - Filter:**

```
(name,John Doe)
```

**SQL:**

```sql
"name" = 'John Doe'
```

---

**Example 5 - Filter:**

```
(title,has,hello world)
```

**SQL:**

```sql
"title"::text ILIKE '%hello world%'
```


## Old Syntax (Deprecated)

The verbose syntax is still supported for backwards compatibility.

### Basic Format

```
(column:columnName,value:val,type:operator)
```

### Type Operators

| Type               | SQL Equivalent  | Example                                          |
| ------------------ | --------------- | ------------------------------------------------ |
| `exact`            | `=`             | `(column:status,value:ACTIVE,type:exact)`        |
| `contains`         | `ILIKE '%val%'` | `(column:name,value:test,type:contains)`         |
| `startsWith`       | `ILIKE 'val%'`  | `(column:email,value:admin,type:startsWith)`     |
| `endsWith`         | `ILIKE '%val'`  | `(column:file,value:.pdf,type:endsWith)`         |
| `greaterThan`      | `>`             | `(column:price,value:100,type:greaterThan)`      |
| `greaterThanEqual` | `>=`            | `(column:price,value:100,type:greaterThanEqual)` |
| `lessThan`         | `<`             | `(column:stock,value:10,type:lessThan)`          |
| `lessThanEqual`    | `<=`            | `(column:score,value:100,type:lessThanEqual)`    |
| `isNull`           | `IS NULL`       | `(column:deletedAt,type:isNull)`                 |

When `type` is omitted:

-   With `value`: defaults to equality (`=`)
-   Without `value`: defaults to `IS NULL`

### Old Syntax Column Paths

**Example 1 - Filter:**

```
(column:id,value:123,type:exact)
```

**SQL:**

```sql
"id" = 123
```

---

**Example 2 - Filter:**

```
(column:orderV2.id,value:215)
```

**SQL:**

```sql
"orderV2"."id" = 215
```

---

**Example 3 - Filter:**

```
(column:order.billingAddress.zip,value:47,type:contains)
```

**SQL:**

```sql
"order"."billingAddress"->>'zip'::text ILIKE '%47%'
```


### Old Syntax Logical Operators

**Example 1 - Filter:**

```
(column:id,value:251)or(column:id,value:278)
```

**SQL:**

```sql
("id" = 251) or ("id" = 278)
```

---

**Example 2 - Filter:**

```
(column:id,value:215)AND(column:totalPriceCents,value:3069,type:greaterThan)
```

**SQL:**

```sql
("id" = 215) AND ("totalPriceCents" > 3069)
```


### Old Syntax Grouping and Negation

**Example 1 - Filter:**

```
((column:id,value:251)or(column:id,value:278))AND(column:status,value:ACTIVE,type:exact)
```

**SQL:**

```sql
(("id" = 251) or ("id" = 278)) AND ("status" = 'ACTIVE')
```

---

**Example 2 - Filter:**

```
!(column:userId,value:15234,type:exact)
```

**SQL:**

```sql
NOT ("userId" = 15234)
```

---

**Example 3 - Filter:**

```
!(column:id,value:4504055,type:contains)and!(column:name,value:jim,type:endsWith)
```

**SQL:**

```sql
NOT ("id"::text ILIKE '%4504055%') and NOT ("name"::text ILIKE '%jim')
```


## Syntax Comparison

| Operation        | New Syntax            | Old Syntax                                       |
| ---------------- | --------------------- | ------------------------------------------------ |
| Equality         | `(status,ACTIVE)`     | `(column:status,value:ACTIVE,type:exact)`        |
| Not equal        | `(status,ne,DELETED)` | —                                                |
| Contains         | `(name,has,test)`     | `(column:name,value:test,type:contains)`         |
| Starts with      | `(email,sw,admin)`    | `(column:email,value:admin,type:startsWith)`     |
| Ends with        | `(file,ew,.pdf)`      | `(column:file,value:.pdf,type:endsWith)`         |
| Greater than     | `(price,gt,100)`      | `(column:price,value:100,type:greaterThan)`      |
| Greater or equal | `(price,gte,100)`     | `(column:price,value:100,type:greaterThanEqual)` |
| Less than        | `(stock,lt,10)`       | `(column:stock,value:10,type:lessThan)`          |
| Less or equal    | `(score,lte,100)`     | `(column:score,value:100,type:lessThanEqual)`    |
| Is null          | `(deletedAt,null)`    | `(column:deletedAt,type:isNull)`                 |
| Is not null      | `(createdAt,notnull)` | —                                                |
| In set           | `(id,in,1\|2\|3)`     | —                                                |

## Value Types

Values are automatically typed based on content:

| Input      | Type   | SQL Output   |
| ---------- | ------ | ------------ |
| `123`      | Number | `123`        |
| `-45.67`   | Number | `-45.67`     |
| `ACTIVE`   | String | `'ACTIVE'`   |
| `John Doe` | String | `'John Doe'` |

## SQL Injection Prevention

The filter parser is designed to prevent SQL injection:

1. **Column names** are always double-quoted as SQL identifiers
2. **Values** are escaped using `pg-format` library
3. **Parentheses** in values are rejected by the grammar (cannot inject sub-expressions)
4. **SQL keywords** in values become harmless literals

Examples of safely escaped input:

**Example 1 - Filter:**

```
(name,O'Brien)
```

**SQL:**

```sql
"name" = 'O''Brien'
```

---

**Example 2 - Filter:**

```
(password,' OR '1'='1)
```

**SQL:**

```sql
"password" = ''' OR ''1''=''1'
```

---

**Example 3 - Filter:**

```
(id,1; DROP TABLE users; --)
```

**SQL:**

```sql
"id" = '1; DROP TABLE users; --'
```

---

**Example 4 - Filter:**

```
(path,C:\\Windows\\System32)
```

**SQL:**

```sql
"path" = E'C:\\Windows\\System32'
```


## Error Cases

The parser rejects malformed input with a `SyntaxError`:

| Invalid Input              | Reason                      |
| -------------------------- | --------------------------- |
| `()`                       | Empty expression            |
| `(field)`                  | Missing value               |
| `(field,)`                 | Empty value                 |
| `(field,gt,)`              | Empty operator value        |
| `(,value)`                 | Missing column              |
| `(a.b.c.d,value)`          | Column path exceeds 3 parts |
| `(((a,1)or(b,2))and(c,3))` | Nesting depth exceeds limit |
